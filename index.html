<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø§Ø¨Ø²Ø§Ø± PPM Ù¾ÛŒØ´Ø±ÙØªÙ‡ â€“ Ù†Ø³Ø®Ù‡ Ø±Ù†Ú¯ÛŒ Ùˆ Ø´ÛŒÚ©</title>
<link href="https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.css" rel="stylesheet" />
<style>
:root{
  --bg: #0f172a;
  --card: #0b1222aa;
  --text: #e2e8f0;
  --muted:#94a3b8;
  --primary:#22c55e;
  --primary-2:#06b6d4;
  --accent:#a855f7;
  --warn:#f59e0b;
  --danger:#ef4444;
  --paper:#f4f7ff;
  --shadow:0 10px 30px rgba(0,0,0,.25);
  --radius:16px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;padding:24px;font-family:Vazir, system-ui, sans-serif;background:radial-gradient(1000px 600px at 10% -10%, #0ea5e94d, transparent 60%),radial-gradient(800px 500px at 110% 10%, #22c55e33, transparent 70%),radial-gradient(700px 400px at 50% 120%, #a855f722, transparent 70%), var(--bg);color:var(--text);}

/* Container */
.container{
  width:min(1100px, 96vw); margin-inline:auto;
  backdrop-filter: blur(12px) saturate(120%);
  background:linear-gradient(180deg, #0b1222e0, #0b1222b0);
  border:1px solid rgba(255,255,255,.08);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  overflow:hidden;
}

/* Header */
.header{position:relative;padding:28px 24px 22px;background:linear-gradient(135deg, #0ea5e980, #22c55e66),linear-gradient(0deg, transparent, #00000022);border-bottom:1px solid rgba(255,255,255,.08);}
.title{display:flex; align-items:center; gap:12px; flex-wrap:wrap;}
.logo{width:42px; height:42px; border-radius:12px; background: conic-gradient(from 0deg, var(--primary), var(--primary-2), var(--accent), var(--primary)); box-shadow: 0 6px 14px #22c55e66, inset 0 0 12px #ffffff22;}
h1{font-size:22px;margin:0}
.sub{color:var(--muted); font-size:13px;}
.header-tools{display:flex; gap:10px; align-items:center; margin-top:12px; flex-wrap:wrap;}
.chip{padding:6px 10px; border-radius:999px; font-size:12px;background:#00000033; border:1px solid #ffffff22; color:#e2e8f0;}
.right{margin-inline-start:auto; display:flex; gap:10px; align-items:center;}
.btn{position:relative;padding:10px 14px;border-radius:12px;border:1px solid #ffffff20;background:#0b1324;color:#e2e8f0;cursor:pointer;font-weight:700;transition: transform .12s ease, box-shadow .2s ease, background .2s ease;box-shadow: 0 4px 12px rgba(0,0,0,.25);display:flex; align-items:center; gap:8px;}
.btn:hover{ transform: translateY(-2px); background:#0e1730; }
.btn.primary{background: linear-gradient(135deg, #10b981, #06b6d4);border:0;color:white;box-shadow: 0 8px 24px #06b6d455;}
.btn.warn{ background: linear-gradient(135deg, #f59e0b, #ef4444); border:0}
.btn:active{ transform: translateY(0) scale(.98) }

/* Grid */
.grid{display:grid; gap:16px; padding:20px; grid-template-columns: repeat(12, 1fr);}
.card{grid-column: span 12; background: linear-gradient(180deg, #0f1a33aa, #0f1a3380); border:1px solid #ffffff14; border-radius: 18px; padding:18px; box-shadow: 0 6px 18px rgba(0,0,0,.25);}
@media (min-width:900px){ .span-6{grid-column: span 6} .span-4{grid-column: span 4} .span-8{grid-column: span 8} }

/* Inputs */
.row{display:grid; gap:12px; grid-template-columns: repeat(12, 1fr)}
.row > .field{grid-column: span 12}
@media (min-width:700px){ .row > .field.span-6{grid-column: span 6} .row > .field.span-3{grid-column: span 3}}
label{display:block; font-size:12px; color:#a7b0c3; margin-bottom:6px}
.input, select{width:100%; padding:12px 14px; border-radius:12px; background:#0a1328; border:1px solid #ffffff22; color:#e7edf7; outline:none; transition:border .2s ease, box-shadow .2s ease, transform .08s ease;}
.input:focus, select:focus{ border-color:#22c55eaa; box-shadow:0 0 0 3px #22c55e33 }
.input::-webkit-outer-spin-button,.input::-webkit-inner-spin-button{ -webkit-appearance: none; margin:0}
.hint{font-size:11px; color:#93a1bb; margin-top:6px}

/* Table */
table{ width:100%; border-collapse: collapse; overflow:hidden; border-radius:14px; font-family: Vazir, sans-serif }
th, td{ padding:10px; border-bottom:1px solid #ffffff17; text-align:center; font-size:13px; font-family: Vazir, sans-serif}
thead th{ background: linear-gradient(0deg, #0c1733, #0b142d); color:#cfe7ff; position:sticky; top:0 }
tbody tr{ transition: background .2s ease }
tbody tr:hover{ background:#0e1a33 }
.badge{font-size:11px; padding:3px 8px; border-radius:999px; background:#0b1a2f; border:1px solid #ffffff1a; color:#cfe7ff}

/* Floating actions */
.fab{position: fixed; inset-inline-end: 22px; inset-block-end: 22px; display:flex; gap:10px; flex-direction:column;}
.fab .btn{border-radius: 50%; width:56px; height:56px; justify-content:center}
.fab .btn svg{width:20px; height:20px}

/* Toast */
.toast{position: fixed; inset-inline:0; inset-block-start: 16px; margin-inline:auto;background: #0b1222; border:1px solid #22c55e55; color:#d1fae5;padding:10px 14px; border-radius:14px; width:min(520px, 96vw);box-shadow: 0 10px 24px #0008; opacity:0; transform: translateY(-10px);transition: opacity .25s ease, transform .25s ease; display:flex; align-items:center; gap:10px; justify-content:center; font-size:14px}
.toast.show{ opacity:1; transform: translateY(0) }

/* Clock line */
.clock{ color:#cbd5e1; font-size:12px; margin-top:6px }

/* Light Mode */
.light{--bg:#eef3ff;color:#0f172a;background:radial-gradient(1000px 600px at 10% -10%, #0ea5e922, transparent 60%),radial-gradient(800px 500px at 110% 10%, #22c55e22, transparent 70%),radial-gradient(700px 400px at 50% 120%, #a855f71a, transparent 70%), var(--paper);}
.light .container{background:linear-gradient(180deg, #ffffffc2, #ffffffaa); border:1px solid #00000010}
.light .card{background:linear-gradient(180deg, #ffffff, #f7fbff); border:1px solid #00000012}
.light .input, .light select{background:#ffffff; color:#0f172a; border:1px solid #0000001a}
.light thead th{background:linear-gradient(0deg, #f0f7ff, #e8f2ff); color:#0f172a}
.light tbody tr:hover{background:#f3f7ff}
.light .btn{background:#ffffff11}
</style>
</head>
<body>

<div class="toast" id="toast">Ù†ØªÛŒØ¬Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯ Ùˆ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ø°Ø®ÛŒØ±Ù‡ Ú¯Ø±Ø¯ÛŒØ¯ âœ…</div>

<div class="container">

<!-- Header -->
<div class="header">
  <div class="title">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>Ø§Ø¨Ø²Ø§Ø± PPM Ù¾ÛŒØ´Ø±ÙØªÙ‡</h1>
      <div class="sub">Ù…Ø­Ø§Ø³Ø¨Ù‡ PPM â‡„ Ø¯Ø±ØµØ¯ â‡„ Ø¬Ø±Ù… â€¢ Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø®Ù„ÙˆØµ Ùˆ ØªØ¨Ø¯ÛŒÙ„ ÙˆØ§Ø­Ø¯</div>
      <div class="clock" id="datetime"></div>
    </div>
  </div>

  <div class="header-tools">
    <span class="chip">ğŸŒ— Ø­Ø§Ù„Øª Ø´Ø¨/Ø±ÙˆØ²</span>
    <span class="chip">â± Ù…ÛŒØ§Ù†Ø¨Ø±: Enter Ø¨Ø±Ø§ÛŒ Ø±ÙØªÙ† Ø¨Ù‡ ÙÛŒÙ„Ø¯ Ø¨Ø¹Ø¯ÛŒ</span>
    <div class="right">
      <button class="btn" id="toggleThemeBtn" title="ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª Ø±Ù†Ú¯">ØªØºÛŒÛŒØ± ØªÙ…</button>
      <button class="btn" id="clearBtn" title="Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø¬Ø¯ÙˆÙ„">Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ù†ØªØ§ÛŒØ¬</button>
    </div>
  </div>
</div>

<!-- Grid / Cards -->
<div class="grid">

<!-- Card 0: Ø±Ø§Ù‡Ù†Ù…Ø§ -->
<div class="card span-12">
<h3 style="margin:0 0 12px 0">ğŸ“– Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡</h3>
<ul class="hint">
  <li>Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ù‚Ø¯Ø§Ø± Ù…Ø§Ø¯Ù‡ Ø§Ø² Ø±ÙˆÛŒ PPMØŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ PPMØŒ Ø®Ù„ÙˆØµ Ùˆ Ø­Ø¬Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ Ùˆ Ø³Ù¾Ø³ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.</li>
  <li>Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ØªØ¨Ø¯ÛŒÙ„ Ø¯Ø±ØµØ¯ â‡„ PPM Ùˆ Ø¬Ø±Ù… â‡„ PPM Ø±Ø§ Ù†ÛŒØ² Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯.</li>
  <li>Ù†ØªØ§ÛŒØ¬ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ Ùˆ Ø¨Ø§ ØªØ§Ø²Ù‡â€ŒØ³Ø§Ø²ÛŒ ØµÙØ­Ù‡ Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ù†Ø¯.</li>
  <li>Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø¬Ø¯ÙˆÙ„ Ø§Ø² Ø¯Ú©Ù…Ù‡ Â«Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ù†ØªØ§ÛŒØ¬Â» Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</li>
</ul>
</div>

<!-- Card 1: PPM â†’ Ù…Ù‚Ø¯Ø§Ø± Ù…Ø§Ø¯Ù‡ -->
<div class="card span-8">
<h3 style="margin:0 0 12px 0">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ù‚Ø¯Ø§Ø± Ù…Ø§Ø¯Ù‡ Ø§Ø² Ø±ÙˆÛŒ PPM</h3>
<div class="row" style="margin-top:6px">
  <div class="field span-3"><label for="ppm">PPM Ù…ÙˆØ±Ø¯Ù†Ø¸Ø±</label><input class="input nav" type="number" id="ppm" placeholder="Ù…Ø«Ù„Ø§Ù‹ 150" /></div>
  <div class="field span-3"><label for="purity">Ø®Ù„ÙˆØµ Ù…Ø§Ø¯Ù‡ (%)</label><input class="input nav" type="number" id="purity" placeholder="Ù…Ø«Ù„Ø§Ù‹ 65" /></div>
  <div class="field span-3"><label for="volume">Ø­Ø¬Ù… Ù…Ø­Ù„ÙˆÙ„</label><input class="input nav" type="number" id="volume" placeholder="Ù…Ø«Ù„Ø§Ù‹ 2" /></div>
  <div class="field span-3"><label for="volumeUnit">ÙˆØ§Ø­Ø¯ Ø­Ø¬Ù…</label><select class="nav" id="volumeUnit"><option value="mL">Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±</option><option value="L" selected>Ù„ÛŒØªØ±</option></select></div>
</div>
<div style="display:flex; gap:10px; margin-top:10px">
  <button class="btn primary" id="calcBtn">âœ… Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
  <button class="btn" id="printBtn">ğŸ–¨ Ú†Ø§Ù¾ Ø¬Ø¯ÙˆÙ„</button>
  <button class="btn" id="csvBtn">ğŸ“¤ Ø®Ø±ÙˆØ¬ÛŒ CSV</button>
</div>
<div class="hint">ÙØ±Ù…ÙˆÙ„: g = (PPM Ã— Ø­Ø¬Ù…(L)) Ã· (1000 Ã— Ø®Ù„ÙˆØµ/100)</div>
</div>

<!-- Ø§Ø¯Ø§Ù…Ù‡â€ŒÛŒ Ú©Ø¯ Ø´Ø§Ù…Ù„ Ø³Ø§ÛŒØ± Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ØŒ Ø¬Ø¯ÙˆÙ„ Ù†ØªØ§ÛŒØ¬ Ùˆ JS ... -->
<!-- Card 2: Ø¯Ø±ØµØ¯ â‡„ PPM -->
<div class="card span-4">
  <h3 style="margin:0 0 12px 0">ØªØ¨Ø¯ÛŒÙ„ Ø¯Ø±ØµØ¯ Ùˆ PPM</h3>
  <div class="row">
    <div class="field span-6"><label for="percentToPPMInput">Ø¯Ø±ØµØ¯ Ù…Ø§Ø¯Ù‡ (%) â†’ PPM</label><input class="input nav" type="number" id="percentToPPMInput" placeholder="Ù…Ø«Ù„Ø§Ù‹ 0.01" /></div>
    <div class="field span-6"><label for="purityPercentToPPM">Ø®Ù„ÙˆØµ (%)</label><input class="input nav" type="number" id="purityPercentToPPM" placeholder="Ù…Ø«Ù„Ø§Ù‹ 65" /></div>
  </div>
  <button class="btn" id="percentToPPMBtn">ğŸ“ Ù…Ø­Ø§Ø³Ø¨Ù‡ PPM</button>
  <p id="percentToPPMOutput" class="hint" style="margin-top:8px"></p>
  <div style="height:8px"></div>
  <div class="row">
    <div class="field span-6"><label for="ppmToPercentInput">PPM â†’ Ø¯Ø±ØµØ¯ Ù…Ø§Ø¯Ù‡ (%)</label><input class="input nav" type="number" id="ppmToPercentInput" placeholder="Ù…Ø«Ù„Ø§Ù‹ 150" /></div>
    <div class="field span-6"><label for="purityPPMToPercent">Ø®Ù„ÙˆØµ (%)</label><input class="input nav" type="number" id="purityPPMToPercent" placeholder="Ù…Ø«Ù„Ø§Ù‹ 65" /></div>
  </div>
  <button class="btn" id="ppmToPercentBtn">ğŸ“ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø±ØµØ¯</button>
  <p id="ppmToPercentOutput" class="hint" style="margin-top:8px"></p>
</div>

<!-- Card 3: Ú¯Ø±Ù… â†’ PPM -->
<div class="card span-6">
  <h3 style="margin:0 0 12px 0">ØªØ¨Ø¯ÛŒÙ„ Ú¯Ø±Ù… Ù…Ø§Ø¯Ù‡ Ø¨Ù‡ PPM</h3>
  <div class="row">
    <div class="field span-3"><label for="gramsToPPMInput">Ø¬Ø±Ù… (g)</label><input class="input nav" type="number" id="gramsToPPMInput" placeholder="Ù…Ø«Ù„Ø§Ù‹ 1" /></div>
    <div class="field span-3"><label for="purityGramsToPPM">Ø®Ù„ÙˆØµ (%)</label><input class="input nav" type="number" id="purityGramsToPPM" placeholder="Ù…Ø«Ù„Ø§Ù‹ 65" /></div>
    <div class="field span-3"><label for="volumeGramsToPPM">Ø­Ø¬Ù…</label><input class="input nav" type="number" id="volumeGramsToPPM" placeholder="Ù…Ø«Ù„Ø§Ù‹ 2" /></div>
    <div class="field span-3"><label for="volumeUnitGrams">ÙˆØ§Ø­Ø¯</label>
      <select class="nav" id="volumeUnitGrams">
        <option value="mL">Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±</option>
        <option value="L" selected>Ù„ÛŒØªØ±</option>
      </select>
    </div>
  </div>
  <button class="btn" id="gramsToPPMBtn">ğŸ”¹ Ù…Ø­Ø§Ø³Ø¨Ù‡ PPM</button>
  <p id="gramsToPPMOutput" class="hint" style="margin-top:8px"></p>
</div>

<!-- Card 4: Ø¬Ø¯ÙˆÙ„ Ù†ØªØ§ÛŒØ¬ -->
<div class="card span-12">
  <h3 style="margin:0 0 12px 0">Ø¬Ø¯ÙˆÙ„ Ù†ØªØ§ÛŒØ¬</h3>
  <div style="overflow:auto; border-radius:14px; border:1px solid #ffffff14">
    <table id="result-table">
      <thead>
        <tr>
          <th>PPM</th>
          <th>Ø®Ù„ÙˆØµ (%)</th>
          <th>Ø­Ø¬Ù…</th>
          <th>mg</th>
          <th>g</th>
          <th>Ø­Ø°Ù</th>
        </tr>
      </thead>
      <tbody id="result-body"></tbody>
    </table>
  </div>
  <div class="hint" style="margin-top:8px">ğŸ“ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ Ùˆ Ø¨Ø§ ØªØ§Ø²Ù‡â€ŒØ³Ø§Ø²ÛŒ ØµÙØ­Ù‡ Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ù†Ø¯.</div>
</div>

<!-- Card 5: Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª -->
<div class="card span-12">
  <h3 style="margin:0 0 12px 0">ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª</h3>
  <p class="hint" style="margin-bottom:4px">Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡: Ù…ØµÛŒØ¨ Ø®Ø§Ù†ÛŒ</p>
  <p class="hint" style="margin-bottom:4px">Ø§ÛŒÙ…ÛŒÙ„: example@mail.com</p>
  <ul class="hint">
    <li>Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ù‡ØªØ±ØŒ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ Ùˆ ÙˆØ§Ø­Ø¯Ù‡Ø§ Ø±Ø§ Ú†Ú© Ú©Ù†ÛŒØ¯.</li>
    <li>Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ CSV Ø®Ø±ÙˆØ¬ÛŒ Ø±Ø§ Ø¯Ø± Ø§Ú©Ø³Ù„ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯ØŒ ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ Ùˆ Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Ø­ÙØ¸ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</li>
  </ul>
</div>

</div> <!-- container -->

<!-- Floating Actions -->
<div class="fab">
  <button class="btn" id="scrollTopBtn" title="Ø±ÙØªÙ† Ø¨Ù‡ Ø¨Ø§Ù„Ø§">â¬†ï¸</button>
</div>

<script>
// ===== Utilities =====
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

function showToast(msg){
  const t = $('#toast');
  t.textContent = msg || 'Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ âœ…';
  t.classList.add('show');
  setTimeout(()=> t.classList.remove('show'), 1800);
}

function updateDateTime(){
  const now = new Date();
  $('#datetime').textContent = 'ğŸ•’ ' + now.toLocaleString('fa-IR');
  setTimeout(updateDateTime, 1000);
}
updateDateTime();

// ===== Theme toggle =====
const toggleThemeBtn = $('#toggleThemeBtn');
const THEME_KEY = 'ppm_theme';
function applyTheme(theme){
  document.body.classList.toggle('light', theme === 'light');
  localStorage.setItem(THEME_KEY, theme);
}
applyTheme(localStorage.getItem(THEME_KEY) || 'dark');
toggleThemeBtn.addEventListener('click', ()=>{
  const cur = document.body.classList.contains('light') ? 'light' : 'dark';
  applyTheme(cur === 'light' ? 'dark' : 'light');
});

// ===== Keyboard navigation =====
function setupEnterFlow(groups){
  groups.forEach(({selectors, onLast})=>{
    const nodes = selectors.map(s => $(s)).filter(Boolean);
    nodes.forEach((el, idx)=>{
      el.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter'){
          e.preventDefault();
          const next = nodes[idx+1];
          if(next){ next.focus(); next.select?.(); }
          else if(typeof onLast === 'function'){ onLast(); }
        }
      });
    });
  });
}
setupEnterFlow([
  { selectors:['#ppm','#purity','#volume','#volumeUnit'], onLast: ()=>$('#calcBtn').click() },
  { selectors:['#percentToPPMInput','#purityPercentToPPM'], onLast: ()=>$('#percentToPPMBtn').click() },
  { selectors:['#ppmToPercentInput','#purityPPMToPercent'], onLast: ()=>$('#ppmToPercentBtn').click() },
  { selectors:['#gramsToPPMInput','#purityGramsToPPM','#volumeGramsToPPM','#volumeUnitGrams'], onLast: ()=>$('#gramsToPPMBtn').click() },
]);

// ===== Core Calculations =====
function calculate(){
  const ppm = parseFloat($('#ppm').value);
  const purity = parseFloat($('#purity').value);
  let volume = parseFloat($('#volume').value);
  const unit = $('#volumeUnit').value;
  if ([ppm,purity,volume].some(v=>isNaN(v) || v<=0)) { alert('Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!'); return; }
  const volumeLiters = unit === 'mL' ? volume/1000 : volume;
  const total_g = (ppm * volumeLiters) / (1000 * (purity/100));
  const total_mg = total_g * 1000;
  const gDisplay = total_g < 0.001 ? total_g.toExponential(2) : total_g.toFixed(3);
  const mgDisplay = total_mg < 0.01 ? total_mg.toExponential(2) : total_mg.toFixed(2);

  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><span class="badge">${ppm}</span></td>
    <td>${purity}</td>
    <td>${volume} ${unit}</td>
    <td>${mgDisplay}</td>
    <td>${gDisplay}</td>
    <td><button class="btn warn" style="padding:6px 10px; border-radius:10px">Ø­Ø°Ù</button></td>
  `;
  tr.querySelector('button').addEventListener('click', ()=>{ tr.remove(); saveData(); showToast('Ø±Ø¯ÛŒÙ Ø­Ø°Ù Ø´Ø¯'); });
  $('#result-body').appendChild(tr);
  saveData();
  showToast('Ù†ØªÛŒØ¬Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯ Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ú¯Ø±Ø¯ÛŒØ¯ âœ…');
}

// ===== Percent â‡„ PPM =====
$('#percentToPPMBtn').addEventListener('click', ()=>{
  const percent = parseFloat($('#percentToPPMInput').value);
  const purity = parseFloat($('#purityPercentToPPM').value);
  if ([percent,purity].some(v=>isNaN(v) || v<=0)) return;
  const ppm = percent * 10000 / (purity/100);
  $('#percentToPPMOutput').textContent = `PPM ØªÙ‚Ø±ÛŒØ¨ÛŒ: ${ppm.toFixed(2)}`;
});
$('#ppmToPercentBtn').addEventListener('click', ()=>{
  const ppm = parseFloat($('#ppmToPercentInput').value);
  const purity = parseFloat($('#purityPPMToPercent').value);
  if ([ppm,purity].some(v=>isNaN(v) || v<=0)) return;
  const percent = ppm * (purity/100) / 10000;
  $('#ppmToPercentOutput').textContent = `Ø¯Ø±ØµØ¯ ØªÙ‚Ø±ÛŒØ¨ÛŒ: ${percent.toFixed(4)}%`;
});

// ===== Grams â†’ PPM =====
$('#gramsToPPMBtn').addEventListener('click', ()=>{
  const grams = parseFloat($('#gramsToPPMInput').value);
  const purity = parseFloat($('#purityGramsToPPM').value);
  let volume = parseFloat($('#volumeGramsToPPM').value);
  const unit = $('#volumeUnitGrams').value;
  if ([grams,purity,volume].some(v=>isNaN(v) || v<=0)) { alert('Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!'); return; }
  const volumeLiters = unit==='mL'?volume/1000:volume;
  const ppm = grams * 1000 / volumeLiters * (purity/100);
  $('#gramsToPPMOutput').textContent = `PPM ØªÙ‚Ø±ÛŒØ¨ÛŒ: ${ppm.toFixed(2)}`;
});

// ===== Table Storage =====
function saveData(){
  const data = [];
  $$('#result-body tr').forEach(tr=>{
    const tds = tr.querySelectorAll('td');
    data.push(Array.from(tds).slice(0,5).map(td=>td.textContent));
  });
  localStorage.setItem('ppm_results', JSON.stringify(data));
}
function loadData(){
  const data = JSON.parse(localStorage.getItem('ppm_results')||'[]');
  data.forEach(([ppm,purity,volume,mg,g])=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${ppm}</td><td>${purity}</td><td>${volume}</td><td>${mg}</td><td>${g}</td><td><button class="btn warn" style="padding:6px 10px; border-radius:10px">Ø­Ø°Ù</button></td>`;
    tr.querySelector('button').addEventListener('click', ()=>{ tr.remove(); saveData(); showToast('Ø±Ø¯ÛŒÙ Ø­Ø°Ù Ø´Ø¯'); });
    $('#result-body').appendChild(tr);
  });
}
loadData();

// ===== Buttons =====
$('#calcBtn').addEventListener('click', calculate);
$('#clearBtn').addEventListener('click', ()=>{
  if(confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ø¬Ø¯ÙˆÙ„ Ù¾Ø§Ú© Ø´ÙˆØ¯ØŸ')){ $('#result-body').innerHTML=''; saveData(); showToast('Ø¬Ø¯ÙˆÙ„ Ù¾Ø§Ú© Ø´Ø¯'); }
});
$('#scrollTopBtn').addEventListener('click', ()=>window.scrollTo({top:0,behavior:'smooth'}));

// ===== CSV Export =====
$('#csvBtn').addEventListener('click', ()=>{
  const rows = [['PPM','Ø®Ù„ÙˆØµ (%)','Ø­Ø¬Ù…','mg','g']];
  $$('#result-body tr').forEach(tr=>{
    const cols = Array.from(tr.querySelectorAll('td')).slice(0,5).map(td=>td.textContent);
    rows.push(cols);
  });
  const csv = rows.map(r=>r.join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'PPM_results.csv';
  a.click();
});

// ===== Print =====
$('#printBtn').addEventListener('click', ()=>window.print());
</script>
</body>
</html>
